#!/usr/bin/env bash
set -euo pipefail

# Найти конфликтные маркеры в индексированных файлах
FILES=$(git diff --cached --name-only)
if [ -z "$FILES" ]; then
  exit 0
fi

if git diff --cached --name-only \
 | xargs -I{} sh -c "grep -Hn -E '^(<<<<<<<|=======|>>>>>>>)' '{}' || true" \
 | grep -E '^(<<<<<<<|=======|>>>>>>>)' >/dev/null 2>&1; then
  echo "ERROR: merge conflict markers detected. Resolve conflicts before commit."
  exit 1
fi

exit 0
